<link rel="stylesheet" href="<%=resource%>/css/common.css">
<% local dsp=require "luci.dispatcher" -%>

<script type="text/javascript" src="<%=resource%>/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="<%=resource%>/echarts.min.js?v=5.0"></script>

	<script type="text/javascript">//<![CDATA[
		let visit_time_data = []; // Use mock data for chart display
		let user_list_data = {
			total_num: 0,
			list: [
				
			]
		}
		let cur_page = 1;
		let page_size = 15;
		let total_num = 0;
		let total_page = 1;

		function getAllUsersData(page) {
			new XHR().get("<%=url('admin/fwx/get_all_users')%>", {flag: 3, page: page, page_size: page_size},
				function (x, data) {
					user_list_data = data.data;
					total_num = data.data.total_num || 0;
					total_page = data.data.total_page || 1;
					cur_page = data.data.page || 1;
					render_user_list(user_list_data);
					render_pagination();
				}
			);
		}

		window.onload = function() {
			cur_page = 1;
			getAllUsersData(cur_page);

			setInterval(function() {
				console.log("get user data");
				getAllUsersData(cur_page);
			}, 3000);
		}

		function showSuccessMessage(message = '<%:Operation succeeded%>') {
			const $modal = $('#modal');
			const $messageElement = $modal.find('p');
			$messageElement.text(message);
			$modal.css('display', 'flex');
			setTimeout(() => {
				$modal.css('display', 'none');
			}, 1000);
		}

		

		function generateMockData() {
			return [
				{ app_id: "App1", visit_time: 3600 },
				{ app_id: "App2", visit_time: 1800 },
				{ app_id: "App3", visit_time: 2400 },
				{ app_id: "App4", visit_time: 1200 },
				{ app_id: "App5", visit_time: 3000 }
			];
		}

		function generateUserListData() {
			return {
				total_num: 5,
				list: [
					{
						hostname: "Device1",
						mac: "00:11:22:33:44:55",
						ip: "192.168.1.2",
						applist: [{ name: "App1" }, { name: "App2" }],
						online: 1
					}
				]
			};
		}

		function generateVisitListData() {
			return {
				list: [
					{
						appname: "App1",
						hostname: "Device1",
						mac: "00:11:22:33:44:55",
						first_time: "2023-10-01 10:00:00",
						total_time: 3600,
						latest_action: 0
					}
			
				]
			};
		}

		function formatRate(bytesPerSec) {
			if (!bytesPerSec || bytesPerSec < 1024) {
				return Math.round(bytesPerSec || 0) + ' B/s';
			} else if (bytesPerSec < 1024 * 1024) {
				return Math.round(bytesPerSec / 1024) + ' KB/s';
			} else {
				return (bytesPerSec / (1024 * 1024)).toFixed(1) + ' MB/s';
			}
		}

		function truncateDeviceName(str, maxLen) {
			if (!str) return str;
			var len = 0;
			var truncated = '';
			for (var i = 0; i < str.length; i++) {
				var charCode = str.charCodeAt(i);
				if (charCode > 127) {
					len += 2;
				} else {
					len += 1;
				}
				if (len > maxLen) {
					return truncated + '...';
				}
				truncated += str[i];
			}
			return str;
		}

		function formatTraffic(bytes) {
			if (!bytes || bytes < 1024) {
				return (bytes || 0) + ' B';
			} else if (bytes < 1024 * 1024) {
				return Math.round(bytes / 1024) + ' KB';
			} else if (bytes < 1024 * 1024 * 1024) {
				return Math.round(bytes / (1024 * 1024)) + ' MB';
			} else {
				return (bytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
			}
		}

		function showTrafficTooltip(event, upTraffic, downTraffic) {
			let $tooltip = $('#traffic-tooltip');
			if ($tooltip.length === 0) {
				$tooltip = $('<div id="traffic-tooltip"></div>').appendTo('body');
				$tooltip.css({
					position: 'absolute',
					backgroundColor: '#2d2d2d',
					color: '#fff',
					padding: '8px 12px',
					borderRadius: '4px',
					fontSize: '12px',
					zIndex: 10000,
					pointerEvents: 'none',
					boxShadow: '0 2px 8px rgba(0,0,0,0.3)',
					whiteSpace: 'pre-line'
				});
			}
			$tooltip.html('<%:Upstream%>: ' + upTraffic + '\n<%:Downstream%>: ' + downTraffic);
			const rect = event.target.getBoundingClientRect();
			$tooltip.css({
				left: (rect.left + rect.width / 2 - $tooltip.outerWidth() / 2) + 'px',
				top: (rect.top - $tooltip.outerHeight() - 8) + 'px',
				display: 'block'
			});
		}

		function hideTrafficTooltip(event) {
			let $tooltip = $('#traffic-tooltip');
			if ($tooltip.length) {
				$tooltip.css('display', 'none');
			}
		}

		function render_user_list(data) {
			const $tb = $('#user_status_table');
			const user_list = data.list;
			if (user_list && $tb.length) {
				$tb.find('tr:gt(0)').remove();
				for (var i = 0; i < user_list.length; i++) {
					var nickname = user_list[i].nickname || "";
					var hostname = user_list[i].hostname || "";
					var displayName = nickname || hostname || "--";
					var fullName = displayName;
					var truncatedName = truncateDeviceName(displayName, 16);

					const $tr = $('<tr class="tr"></tr>');
					if (user_list[i].online != 1) {
						$tr.css('color', '#A9A9A9');
					}
					$tr.append(`<td class="td">
						<div style="display: flex; align-items: center;">
							<div>
								<div title="${fullName}">${truncatedName}</div>
								<div>${user_list[i].mac}</div>
							</div>
						</div>
					</td>`);
					$tr.append(`<td class="td">${user_list[i].ip}</td>`);
					var upRate = formatRate(user_list[i].up_rate || 0);
					$tr.append('<td class="td"><span style="color: #60a5fa;">' + upRate + '</span></td>');
					var downRate = formatRate(user_list[i].down_rate || 0);
					$tr.append('<td class="td"><span style="color: #22c55e;">' + downRate + '</span></td>');
					var todayUpBytes = user_list[i].today_up_bytes || 0;
					var todayDownBytes = user_list[i].today_down_bytes || 0;
					var totalTraffic = todayUpBytes + todayDownBytes;
					var upTrafficStr = formatTraffic(todayUpBytes);
					var downTrafficStr = formatTraffic(todayDownBytes);
					var totalTrafficStr = formatTraffic(totalTraffic);
					var cellId = 'traffic-cell-' + i;
					$tr.append('<td class="td"><span id="' + cellId + '" style="position: relative;" onmouseenter="showTrafficTooltip(event, \'' + upTrafficStr + '\', \'' + downTrafficStr + '\')" onmouseleave="hideTrafficTooltip(event)">' + totalTrafficStr + '</span></td>');
				     if (!Array.isArray(user_list[i].applist))           
                         user_list[i].applist = [] 
					var app_list_str = user_list[i].applist.map(app => {
						return `<img src="<%=resource%>/app_icons/${app.id}.png" alt="${app.name}" title="${app.name}" style="width: 20px; height: 20px; border-radius: 5px; margin-right: 8px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 1px 3px rgba(0,0,0,0.3); object-fit: cover;">`;
					}).join("") || "--";
					$tr.append('<td class="td">' + app_list_str + '</td>');
					var current_app = user_list[i].app || "--";
					$tr.append('<td class="td">' + current_app + '</td>');
					var current_url = user_list[i].url || "--";
					var display_url = current_url;
					if (current_url !== "--" && current_url.length > 20) {
						display_url = current_url.substring(0, 20) + "...";
					}
					$tr.append(`<td class="td"><span title="${current_url}">${display_url}</span></td>`);
					$tr.append(`<td class="td">${user_list[i].online == 1 
						? `<span style="color: #22c55e;"><%:Online%></span>` 
						: "<%:Offline%>"}</td>`);
					var macEncoded = encodeURIComponent(user_list[i].mac);
					$tr.append(`
						<td class="td">
							<button type="button" class="cbi-button cbi-button-add" onclick="window.location.href='<%=url("admin/fwx_user/detail")%>?mac=' + encodeURIComponent('${user_list[i].mac}')" style="margin-right: 5px;"><%:Detail%></button>
							<button type="button" class="cbi-button cbi-button-add" onclick="showModifyNickname('${user_list[i].mac}')"><%:Remark%></button>
						</td>
					`);
					$tb.append($tr);
				}
			}
		}

		function render_pagination() {
			const $paginationDiv = $('#pagination');
			if ($paginationDiv.length === 0) return;
			
			if (total_page <= 1) {
				$paginationDiv.html('');
				return;
			}
			
			let html = '<div style="display: flex; justify-content: center; align-items: center; margin: 20px 0; gap: 5px;">';
			
			if (cur_page > 1) {
				html += '<button type="button" class="cbi-button" onclick="goToPage(' + (cur_page - 1) + ')" style="min-width: 60px;"><%:Prev Page%></button>';
			} else {
				html += '<button type="button" class="cbi-button" disabled style="min-width: 60px; opacity: 0.5;"><%:Prev Page%></button>';
			}
			
			var startPage = Math.max(1, cur_page - 2);
			var endPage = Math.min(total_page, cur_page + 2);
			
			if (startPage > 1) {
				html += '<button type="button" class="cbi-button" onclick="goToPage(1)" style="min-width: 40px;">1</button>';
				if (startPage > 2) {
					html += '<span style="padding: 0 5px;">...</span>';
				}
			}
			
			for (var i = startPage; i <= endPage; i++) {
				if (i === cur_page) {
					html += '<button type="button" class="cbi-button cbi-button-action" style="min-width: 40px; font-weight: bold;">' + i + '</button>';
				} else {
					html += '<button type="button" class="cbi-button" onclick="goToPage(' + i + ')" style="min-width: 40px;">' + i + '</button>';
				}
			}
			
			if (endPage < total_page) {
				if (endPage < total_page - 1) {
					html += '<span style="padding: 0 5px;">...</span>';
				}
				html += '<button type="button" class="cbi-button" onclick="goToPage(' + total_page + ')" style="min-width: 40px;">' + total_page + '</button>';
			}
			
			if (cur_page < total_page) {
				html += '<button type="button" class="cbi-button" onclick="goToPage(' + (cur_page + 1) + ')" style="min-width: 60px;"><%:Next Page%></button>';
			} else {
				html += '<button type="button" class="cbi-button" disabled style="min-width: 60px; opacity: 0.5;"><%:Next Page%></button>';
			}
			
			var startRecord = (cur_page - 1) * page_size + 1;
			var endRecord = Math.min(cur_page * page_size, total_num);
			html += '<span style="margin-left: 20px; color: #999;"><%:Total%> ' + total_num + ' <%:Records%>, <%:Showing%> ' + startRecord + '-' + endRecord + ' </span>';
			
			html += '</div>';
			$paginationDiv.html(html);
		}
		
		function goToPage(page) {
			if (page < 1 || page > total_page || page === cur_page) {
				return;
			}
			cur_page = page;
			getAllUsersData(cur_page);
		}

		function render_visit_list_table(data) {
			const $tb = $('#visit_list_table');
			var visit_list = data.list;
			if (visit_list && $tb.length) {
				$tb.find('tr:gt(0)').remove();
				for (var i = 0; i < visit_list.length; i++) {
					var action_status = visit_list[i].act == 1 ? "<%:Filtered%>" : "<%:Unfiltered%>";
					var hostname = visit_list[i].hostname == "" || visit_list[i].hostname == "*" ? "--" : visit_list[i].hostname;
					const $tr = $('<tr class="tr"></tr>');

					$tr.append(`
						<td class="td">
							<div style="height: 24px; display: flex; align-items: center;">
								<img src="<%=resource%>/app_icons/${visit_list[i].id}.png" alt="${visit_list[i].name}" title="${visit_list[i].name}" style="width: 20px; height: 20px; border-radius: 5px; margin-right: 4px;">
								<span>${visit_list[i].name}</span>
							</div>
						</td>
					`);

					var first_time_str = new Date(visit_list[i].ft * 1000).toLocaleString();
					var latest_time_str = new Date(visit_list[i].lt * 1000).toLocaleString();

					$tr.append('<td class="td">' + first_time_str + '</td>');
					$tr.append('<td class="td">' + latest_time_str + '</td>');
					var hour = parseInt(visit_list[i].tt / 3600);
					var seconds = visit_list[i].tt % 3600;
					var min = parseInt(seconds / 60)
					var total_time_str;
					if (visit_list[i].act == 1)
						total_time_str = "-"
					else {
						if (hour > 0)
							total_time_str = hour + "<%:h%>" + min + "<%:m%>"
						else {
							if (min == 0)
								min = 1;
							total_time_str = min + "<%:m%>"
						}
					}

					$tr.append('<td class="td">' + total_time_str + '</td>');
					$tr.append('<td class="td">' + action_status + '</td>');

					$tb.append($tr);
				}
			}
		}


		function showDetails(mac) {
			var $modal = $('#detailsModal');
			$modal.css('display', 'flex');

			new XHR().get("<%=url('admin/fwx/dev_visit_time')%>/" + mac, null,
				function (x, st) {
					visit_time_data = st;
					console.log("visit_time_data = " + visit_time_data);
					display_app_visit_view(visit_time_data);
				}
			);

			new XHR().get("<%=url('admin/fwx/dev_visit_list')%>/" + mac, null,
				function (x, st) {
					visit_list_data = st;
					console.log("visit_list_data = " + visit_list_data);
					render_visit_list_table(visit_list_data);
				}
			);
		}

		function showModifyNickname(mac) {
			var $modal = $('#nicknameModal');
			$modal.css('display', 'flex');
			$('#nicknameMac').val(mac);
			$('#nicknameMacDisplay').text(mac);
			$('#nicknameInput').val('');
		}

		function validateNickname(nickname) {
			const invalidChars = /[\s'"]/;
			return !invalidChars.test(nickname) && nickname.length <= 32;
		}

		function submitNicknameChange() {
			var mac = $('#nicknameMac').val();
			var nickname = $('#nicknameInput').val();

			if (!validateNickname(nickname)) {
				alert('<%:Please enter a valid remark%>');
				return;
			}

			new XHR().post("<%=url('admin/fwx/set_nickname')%>", 
			{ mac: mac, nickname: nickname },
			function(x, data) {
				console.log('Nickname updated successfully');
				closeModal('nicknameModal');
				showSuccessMessage('<%:Operation succeeded%>');
				getAllUsersData(cur_page);
			});
		}

		function closeModal(modalId) {
			var $modal = $('#' + modalId);
			if ($modal.length) {
				$modal.css('display', 'none');
			}
		}

		function showTabContent(tabId) {
			var $tabs = $('.tab-body');
			var $tabItems = $('.tab-item');

			$tabs.removeClass('active');
			$tabItems.removeClass('active');

			$('#' + tabId).addClass('active');
			$('.tab-item[onclick="showTabContent(\'' + tabId + '\')"]').addClass('active');
		}

    function get_display_time(total_time) {
        var hour = parseInt(total_time / 3600);
        var seconds = total_time % 3600;
        var min = parseInt(seconds / 60)
        var seconds2 = seconds % 60;
        var total_time_str;

        if (hour > 0)
            total_time_str = hour + "<%:h%>" + min + "<%:m%>"
        else {
            if (min == 0 && seconds2 != 0)
                min = 1;
            total_time_str = min + "<%:m%>"
        }
        return total_time_str;
    }

    function display_app_visit_view(data) {
        var $chartElement = $('#app_time_chart');
        if ($chartElement.length === 0) {
            console.error("Chart element not found");
            return;
        }
        var myChart = echarts.init($chartElement.get(0));
        if (!data) {
            return;
        }
        
        var themeTextColor = '#c9d1d9'; 
        try {
            var bodyStyle = window.getComputedStyle(document.body);
            themeTextColor = bodyStyle.color || themeTextColor;
        } catch(e) {
        }
		var total_time = 0
		var app_stat_array = new Array();
		if (data.length == 0){
			var app_obj ={}
			app_obj.name = "<%:Unknown App%>"
			app_obj.value = 0
			app_obj.legendname = app_obj.name
			app_stat_array.push(app_obj)
		}
		else{
			for (var i = 0; i < data.length; i++) {
				var app_obj = {};
				app_obj.value = data[i].t;
				app_obj.legendname = data[i].name;
				var tmp_time = get_display_time(data[i].t);
				app_obj.name = data[i].name + "  " + tmp_time;
				total_time += data[i].t
				app_stat_array.push(app_obj);
			}
		}
		console.log("hello")
        var total_time_str = get_display_time(total_time);
        
        var palette = [
            '#34d399',  // emerald-400 
            '#22c55e',  // green-500 
            '#06b6d4',  // cyan-500
            '#60a5fa',  // blue-400 
            '#a78bfa',  // violet-400 
            '#f472b6',  // pink-400 
            '#fb923c',  // orange-400 
            '#fbbf24',  // amber-400 
            '#10b981',  // emerald-500
            '#3b82f6',  // blue-500
            '#8b5cf6',  // violet-500 
            '#ec4899'   // pink-500
        ];
        
        var option = {
			backgroundColor: 'transparent',
			color: palette,
			textStyle: {
				color: themeTextColor  
			},
			grid:{
			},
            title: [
                {
                    text: "<%:App Time Statistics%>",
                    textStyle: {
                        fontSize: 16,
                        color: themeTextColor  
                    },
                    left: "2%"
                },
                {
                    text: '',
                    subtext: total_time_str,
                    textStyle: {
                        fontSize: 15,
                        color: themeTextColor  
                    },
                    subtextStyle: {
                        fontSize: 15,
                        color: themeTextColor 
                    },
                    textAlign: "center",
                    x: '34.5%',
                    y: '44%',
                }],
            tooltip: {
                trigger: 'item',
                formatter: function (parms) {
                    var total_time = get_display_time(parms.data.value);
                    var str = parms.seriesName + "</br>" +
                        parms.marker + "" + parms.data.legendname + "</br>" +
                        "<%:Visit Time%>: " + total_time + "</br>" +
                        "<%:Percentage%>: " + parms.percent + "%";
                    return str;
                }
            },
            legend: {
                type: "scroll",
                orient: 'vertical',
                left: '75%',
                align: 'left',
                top: 'middle',
                textStyle: {
                    color: themeTextColor  // 使用主题文字颜色
                },
                height: 250
            },
            series: [
                {
                    name: "<%:Visit Time%>",
                    type: 'pie',
                    radius: ['58%', '70%'],
                    center: ['35%', '50%'], // 饼图的中心位置,调整离开左侧的距离
                    clockwise: false,
                    avoidLabelOverlap: true,
                    itemStyle: {
                        borderRadius: 1,
                        borderColor: "#fff",
                        borderWidth: 1,
                    },
                    label: {
                        show: true,
                        position: 'outside',
                        formatter: '{b}: {c} ({d}%)',
                        normal: {
                            show: true,
                            position: 'outter',
                            formatter: function (parms) {
                                return parms.data.legendname
                            }
                        }
                    },
                    labelLine: {
                        show: true,
                        length: 8,
                        length2: 7,
                        smooth: true,
                    },
                    data: app_stat_array
                }
            ]
        };

        myChart.setOption(option);
    }

//]]></script>

<div style="max-height: 750px; overflow-y: auto;padding-right: 20px;"> <!-- Added container with fixed height and overflow -->

	<div class="cbi-section cbi-tblsection">

		<div>

		<table class="table cbi-section-table" id="user_status_table" style="table-layout: fixed; width: 100%;">
			<tr class="tr">
				<th class="th" style="width: 90px;">
					<%:Device Info%>
				</th>
				<th class="th" style="width: 75px;">
					<%:IP Address%>
				</th>
				<th class="th" style="width: 60px;">
					<%:Upstream Rate%>
				</th>
				<th class="th" style="width: 60px;">
					<%:Downstream Rate%>
				</th>
				<th class="th" style="width: 60px;">
					<%:Today Traffic%>
				</th>
				<th class="th" style="width: 110px;">
					<%:Common App(TOP5)%>
				</th>
				<th class="th" style="width: 70px;">
					<%:Active Apps%>
				</th>
				<th class="th" style="width: 110px;">
					<%:Visiting URL%>
				</th>
				<th class="th" style="width: 55px;">
					<%:Online Status%>
				</th>
				<th class="th" style="width: 120px;">
					<%:Actions%>
				</th>
			</tr>
			<tr class="tr">
				<td class="td" colspan="12"><em><br />
						<%:Collecting data...%>
					</em></td>
			</tr>
		</table>

		</div>
		
		<div id="pagination" style="margin-top: 20px;"></div>
		
	</div>
</div>
<div id="detailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 10000; justify-content: center; align-items: center;">
    <div class="modal-content" style="background-color: #2d2d2d; color: #ffffff; padding: 20px; border-radius: 5px; width: 750px; height: 500px; max-height: 90vh; overflow-y: auto; position: relative;">
        <button type="button" onclick="closeModal('detailsModal')" class="modal-close" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; line-height: 30px;">&times;</button>
        <h4 style="margin: 0 0 20px 0; color: #fff;"><%:Terminal Detail%></h4>
        
        <ul class="tab-list">
            <li class="tab-item active" onclick="showTabContent('tab2')"><%:App Statistics%></li>
			<li class="tab-item" onclick="showTabContent('tab3')"><%:Visit Records%></li>
        </ul>

        <div id="tab2" class="tab-body active">
			<div class="pie-chart">
				<div id="app_time_chart" style="width:100%;height: 350px;">
				</div>
			</div>
        </div>

		<div id="tab3" class="tab-body">
			<div style="max-height: 350px; overflow-y: auto;padding-right: 20px;"> <!-- Added container with fixed height and overflow -->
				<table class="table cbi-section-table" id="visit_list_table">
					<tr class="tr table-titles">
						<th class="th">
							<%:App Name%>
						</th>
			
						<th class="th">
							<%:First Visit%>
						</th>

						<th class="th">
							<%:Last Visit%>
						</th>
						<th class="th">
							<%:Duration%>
						</th>
						<th class="th">
							<%:Filter Status%>
						</th>
					</tr>
					<tr class="tr">
						<td class="td" colspan="8"><em><br />
								<%:Collecting data...%>
							</em></td>
					</tr>
				</table>
			</div>
		</div>

    </div>
</div>

<div id="nicknameModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 10000; justify-content: center; align-items: center;">
    <div class="modal-content" style="background-color: #2d2d2d; color: #ffffff; padding: 20px; border-radius: 5px; width: 400px; position: relative;">
        <button type="button" onclick="closeModal('nicknameModal')" class="modal-close" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; line-height: 30px;">&times;</button>
        <h4 style="margin: 0 0 20px 0; color: #fff;"><%:Edit Remark%></h4>
        <p style="margin-bottom: 10px;"><span class="field-label"><%:MAC Address%>:</span> <span id="nicknameMacDisplay">--</span></p>
        <input type="hidden" id="nicknameMac" value="">
        <p style="margin-bottom: 10px;"><span class="field-label"><%:Remark%>:</span> <input type="text" id="nicknameInput" style="padding: 5px; background-color: #1e1e1e; color: #ffffff; border: 1px solid #555; width: 200px"></p>
        <div style="display: flex; justify-content: flex-end;">
			<button type="button" class="cbi-button cbi-button-add" onclick="closeModal('nicknameModal')"><%:Cancel%></button>
            <button type="button" class="cbi-button cbi-button-add" onclick="submitNicknameChange()" style="margin-right: 10px;"><%:Confirm%></button>
        </div>
    </div>
</div>

<div id="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
	<div style="background-color: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 5px; text-align: center; width: 100px; height: 70px; color: white; display: flex; justify-content: center; align-items: center;">
		<p style="margin: 0;color:white;"><%:Operation succeeded%></p>
	</div>
</div>
<style>
    .tab-container {
        margin-top: 20px;
    }
    .tab-list {
        display: flex;
        list-style-type: none;
        padding: 0;
        margin: 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .tab-item {
        padding: 8px 16px;
        cursor: pointer;
        border: 1px solid rgba(255,255,255,0.1);
        border-bottom: none;
        background-color: rgba(255,255,255,0.05);
        border-radius: 5px 5px 0 0;
        margin-right: 6px;
        transition: all 0.2s ease;
        color: rgba(255,255,255,0.7);
        font-size: 13px;
    }
    .tab-item.active {
        font-weight: 600;
		background-color: rgba(59, 130, 246, 0.3);
        border-color: rgba(59, 130, 246, 0.5);
        color: #60a5fa;
    }
    .tab-item:hover {
        background-color: rgba(255,255,255,0.1);
        color: rgba(255,255,255,0.9);
    }

	.tab-body {
		margin-top: 5px;
		display: none;
		padding: 25px;
	}
	.tab-body.active {
		display: block;
	}

	.pie-chart {
		width: 600px;
	}

	.field-label {
		font-weight: bold;
		color: #ccc;
		width: 75px; /* Set a fixed width for all labels */
		display: inline-block; /* Ensure the width is applied */
	}
	.field-value {
		color: #4CAF50;
	}
	
	.modal-close:hover {
		color: #ccc;
	}
	.info-container {
		display: flex;
		flex-direction: column;
		gap: 10px;
		margin-left: 20px;
	}
	.info-row {
		display: flex;
	}
	.info-column {
		width: 50%;
		text-align: left;
	}
	.info-column p {
		margin-bottom: 20px;
	}

	#user_status_table .td {
		padding-left: 10px !important; /* 5px margin-left + 2px original padding */
	}

	#visit_list_table .td {
		padding: 4px 8px !important; /* 调整访问记录表格的行高 */
		height: 28px !important; /* 设置固定行高 */
		vertical-align: middle !important; /* 垂直居中对齐 */
	}

	#visit_list_table .th {
		padding: 6px 8px !important; /* 调整表头行高 */
		height: 32px !important; /* 设置固定表头行高 */
		vertical-align: middle !important; /* 垂直居中对齐 */
	}

</style>

